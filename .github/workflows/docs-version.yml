name: docs-version

on:
    workflow_dispatch:
        inputs:
            version:
                description: "Version tag to publish (e.g., v0.1.0)"
                required: true
            alias_latest:
                description: "Also update latest alias? (true/false)"
                required: false
                default: "true"

permissions:
    contents: write

jobs:
    version-docs:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4
            - uses: actions/setup-python@v5
              with:
                  python-version: "3.13"
            - name: Install uv
              run: pip install uv
            - name: Sync env (dev deps)
              run: uv sync --dev
            - name: Configure Git User
              run: |
                  git config user.name "github-actions"
                  git config user.email "actions@users.noreply.github.com"
            - name: Build versioned docs
              run: |
                  ver="${{ github.event.inputs.version }}"
                  uv run mike deploy --push --update-aliases "${ver}" $( [ "${{ github.event.inputs.alias_latest }}" = "true" ] && echo latest )
                  uv run mike set-default --push latest
